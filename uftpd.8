.\"
.\" Copyright (c) 2014-2015  Joachim Nilsson <troglobit@gmail.com>
.\"
.\" Permission to use, copy, modify, and/or distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd Jan 09, 2016
.Dt UFTPD 8
.Os "uftpd (1.9)"
.Sh NAME
.Nm uftpd
.Nd
No nonsense TFTP/FTP Server
.Sh SYNOPSIS
.Nm uftpd
.Op Fl dinsvV
.Op Ar PATH
.Sh DESCRIPTION
.Nm uftpd
is a very simple TFTP and anonymous FTP server with inetd support.  It
listens on standard Internet ports for each protocol, as defined in the
system service specification,
.Pa /etc/services ,
unless other ports are given on the command line.  For details, see
.Xr services 5 .
.Pp
Without any command line arguments
.Nm
serves both FTP and TFTP and automatically backgrounds itself.  Usually
.Nm
this means listen to port 21 (FTP) and port 69 (TFTP), serve files from
.Pa /srv/ftp ,
and log anything out of the ordinary to syslog.  Messages are written to
the syslog using the
.Nm LOG_FTP
facility.
.Pp
Available options:
.Bl -tag -width Ds
.It Fl d
Enable developer debug messages.
.It Fl n
Run in foreground, do not detach from controlling terminal
.It Fl s
Use syslog, even if running in foreground, default when running in the
background.
.It Fl v
Show program version
.It Fl V
Verbose logging
.It Fl h
Show built-in help text
.El
.Pp
.Nm
defaults to serve files from the FTP user's $HOME, unless a different
non-option
.Ar PATH
is given on the command line.
.Pp
.Sh Inetd
.Nm
can also be used with an Internet superserver, like the traditional
inetd or modern init replacements like finit.  In inetd mode the server
takes client connections from stdin.  To enable inetd mode
.Nm
must be called as either
.Nm in.tftpd
or
.Nm in.ftpd
.Pp
.Sh FTP
The file
.Pa /etc/nologin
can be used to disable FTP access.  If the file exists,
.Nm
displays it and exits.  If the file
.Pa /etc/ftpwelcome
exists,
.Nm
prints it before issuing the
.Dq ready
message.
If the file
.Pa /etc/motd
exists,
.Nm
prints it after a successful login.  If the file
.Pa .message
exists in a directory,
.Nm
prints it when that directory is entered.
.Pp
The FTP server currently supports the following requests.
The case of the requests is ignored.
.Bl -column "Request" -offset indent
.It Request Ta "Description"
.It CWD Ta "change working directory"
.It DELE Ta "delete a file"
.It LIST Ta "give list files in a directory" Pq Dq Li "ls -lgA"
.It NLST Ta "like LIST, but much less verbose"
.It MKD Ta "make a directory"
.It NOOP Ta "do nothing, used for keep-alive"
.It PASS Ta "specify password"
.It PASV Ta "prepare for server-to-server transfer"
.It PORT Ta "specify data connection port"
.It PWD Ta "print the current working directory"
.It QUIT Ta "terminate session"
.It RETR Ta "retrieve a file"
.It RMD Ta "remove a directory"
.It RNFR Ta "specify rename-from file name"
.It RNTO Ta "specify rename-to file name"
.It SIZE Ta "return size of file"
.It STOR Ta "store a file"
.It SYST Ta "show operating system type of server system"
.It TYPE Ta "specify data transfer" Em type
.It USER Ta "specify user name"
.El
.Pp
Remaining FTP requests, as specified in Internet RFC 959, are not
recognized at the moment.  Patches are welcome!
.Pp
.Sh TFTP
uftpd also supports TFTP, the Trivial File Transfer Protocol, which is
often used for net booting diskless devices, e.g., BOOTP and PXEBOOT.
.Pp
The TFTP server currently supports the following requests.
.Bl -column "Request" -offset indent
.It RRQ
.It ERROR
.It ACK
.El
.Pp
uftpd supports TFTP blocksize negotiation, according to RFC 2348.
Support for WRQ is not yet implemented, patches welcome!
.Pp
.Sh FILES
.Bl -tag -width /etc/ftpwelcome -compact
.It Pa /etc/ftpwelcome
FTP Welcome notice.
.It Pa /etc/motd
Message of the day, presented after successful FTP login.
.It Pa /etc/nologin
Displayed to user attempting to connect.  Access is refused if this
file exists.
.El
.Sh SEE ALSO
.Xr ftp 1 ,
.Xr syslogd 8
.Sh BUGS
Here be dragons.
